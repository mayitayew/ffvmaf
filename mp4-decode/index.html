<!doctype html>
<!DOCTYPE html>
<html>
<head>
  <title>WebCodec MP4 frame extration demo</title>
  <meta http-equiv="origin-trial" content="ArdlZia9G23wi6S2x/vVoTla5x9r1wtreSPqhUq36tpGH7HRmAkPgpBnpkfePFeClDJDzzYAhtDPoI5hJioArAYAAABjeyJvcmlnaW4iOiJodHRwczovL3czYy5naXRodWIuaW86NDQzIiwiZmVhdHVyZSI6IldlYkNvZGVjcyIsImV4cGlyeSI6MTYzODQwMzE5OSwiaXNTdWJkb21haW4iOnRydWV9" />
</head>
<body>
  <p>
    This demo extracts all frames from an MP4 file and renders them to a canvas as fast as possible. It uses <a href="https://github.com/gpac/mp4box.js/">mp4box.js</a> to parse and demux the file.
  </p>
  <input type="file" id="input"/>
  <button id="button">Upload</button>
  <canvas  width="1280" height="720" style="border:1px solid"></canvas>
</body>


<script type="module">
  var demuxDecodeWorker;

  var canvas = document.querySelector("canvas");
  var offscreen = canvas.transferControlToOffscreen();
  document.body.appendChild(canvas);

  var frameCount = 0;
  var startTime;
  var ffVmafModule;

  var url;
  const fileSelector = document.getElementById("input");
  fileSelector.addEventListener('change',(event) => {
    if (event.target.files.length > 0) {
      url = URL.createObjectURL(event.target.files[0]);
      console.log("Uploaded file has url: ", url)
    }
  });

  demuxDecodeWorker = new Worker("./demux_decode_worker.js");
  var button = document.querySelector("button");
  button.onclick = () => {
    demuxDecodeWorker.postMessage({ canvas: offscreen, uri: url}, [offscreen]);
  }
</script>

</html>

